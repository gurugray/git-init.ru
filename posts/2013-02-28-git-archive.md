---
title: "git archive"
date: 2013-02-28
tags: post
permalink: "2013/post/git-archive.html"

layout: layouts/post.njk
---

В git есть такая удобная штука, как [git-archive](http://git-scm.com/docs/git-archive).
Она _(по документации)_ должна дать возможность выкачать состояние файловой структуры по идентификатору состояния — тег, ветка, хеш-коммита, хеш-дерева состояния, а также уточнить те файлы и директории, которые хотите получить в архиве.
Эта команда работает как для локального, так и для remote-репозитория.

Но не на всех серверах возможно выполнения такой процедуры — это выполнение отдельной команды на сервере, а значит чревато проблемами и она _(команда)_ отключена по умолчанию в конфигурации в простом [git daemon](http://git-scm.com/docs/git-daemon)

А GitHub ругается примерно так:

<pre>fatal: remote error:
  Your Git client has made an invalid request:
  003agit-upload-archive /gurugray/xxxxx.git</pre>

Но и это ещё не всё — c версии 1.8.0 благодаря коммиту [archive: don't let remote clients get unreachable commits](https://github.com/git/git/commit/ee27ca4a781844ddbf556ec64daae24d748a7c5a) взять любое состояние remote-репозитория по хэшу невозможно, только по ссылке — имени ветки, тэгу.

Но нам иногда нужна подобная функциональность, что бы вытягивать в проект состояние мелких проектов по заданному состоянию.

В GitHub есть есть подобное через http интерфейс:
`https://github.yandex./$Repo/archive/$ref.zip _($Repo — путь к репозиторию, $Ref — имя ветки или тэга)_`, но указать конкретные папки и файлы уже нельзя — их прийдётся отфильтровывать уже локально.

Если же у вас запущен [git instaweb](http://git-scm.com/docs/git-instaweb), то это можно сделать так:
`https://localhost/$Repo?a=snapshot;h=%Ref;sf=tgz _($Repo — путь к репозиторию, $Ref — имя ветки, тэга, или хэш коммита)_` но файлы тоже нельзя выбирать, к сожалению.

Ну а «закрашенную» функциональность вытягивания архива по хэшу коммита я постараюсь исправить в самом git ;).
